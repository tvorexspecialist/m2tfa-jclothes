<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     default_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/** @var $this MageHackDay_TwoFactorAuth_Block_Adminhtml_Qr */
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title><?php echo Mage::helper('adminhtml')->__('Two Factor Authentication'); ?></title>
    <link type="text/css" rel="stylesheet" href="<?php echo $this->getSkinUrl('reset.css'); ?>" media="all" />
    <link type="text/css" rel="stylesheet" href="<?php echo $this->getSkinUrl('boxes.css'); ?>" media="all" />
    <link type="text/css" rel="stylesheet" href="<?php echo $this->getSkinUrl('twofactorauth.css'); ?>" media="all" />
    <link rel="icon" href="<?php echo $this->getSkinUrl('favicon.ico'); ?>" type="image/x-icon" />
    <link rel="shortcut icon" href="<?php echo $this->getSkinUrl('favicon.ico'); ?>" type="image/x-icon" />

    <script type="text/javascript" src="<?php echo $this->getJsUrl(); ?>index.php/x.js?f=prototype/prototype.js,prototype/validation.js,mage/adminhtml/events.js,mage/adminhtml/form.js,scriptaculous/effects.js"></script>

    <!--[if IE]> <link rel="stylesheet" href="<?php echo $this->getSkinUrl('iestyles.css'); ?>" type="text/css" media="all" /> <![endif]-->
    <!--[if lt IE 7]> <link rel="stylesheet" href="<?php echo $this->getSkinUrl('below_ie7.css'); ?>" type="text/css" media="all" /> <![endif]-->
    <!--[if IE 7]> <link rel="stylesheet" href="<?php echo $this->getSkinUrl('ie7.css'); ?>" type="text/css" media="all" /> <![endif]-->
</head>
<body>
<div id="qr">
    <form method="post" id="qrForm" action="<?php echo $this->getUrl('adminhtml/twofactorauth/qrSubmit') ?>">
        <fieldset>
            <input name="form_key" type="hidden" value="<?php echo $this->getFormKey(); ?>" />
            <div id="messages">
                <?php echo $this->getMessagesBlock()->getGroupedHtml(); ?>
            </div>
            <h2 style="text-align:center;"><?php echo Mage::helper('twofactorauth')->__('Two-Factor Authentication Setup'); ?></h2>
            <?php /* QR code */ ?>
            <?php if ($this->getUser()->getTwofactorToken()): // Display reset link ?>
                <a href="<?php echo $this->getUrl('adminhtml/twofactorauth/reset') ?>" title="<?php echo Mage::helper('twofactorauth')->__('Reset Two-Factor Authentication') ?>"><?php echo Mage::helper('twofactorauth')->__('Reset Two-Factor Authentication') ?></a>
            <?php else: // Display QR code ?>
                <table class="qr">
                    <tr>
                        <td><img src="<?php echo $this->getQrCodeUrl() ?>" alt="<?php echo Mage::helper('twofactorauth')->__('QR Code') ?>" width="200px" height="200px"/></td>
                        <td>
                            <label for="security_code"><?php echo Mage::helper('twofactorauth')->__('Security Code') ?></label><br />
                            <input type="text" id="security_code" name="security_code" value="" class="required-entry input-text" /><br />
                            <input type="hidden" name="qr_secret" value="<?php echo $this->getQrCodeSecret() ?>" />
                            <span><?php echo Mage::helper('twofactorauth')->__('Scan the QR code into Google Authenticator, then enter the code here and click save.') ?></span>
                            <div>
                                <input type="checkbox" title="<?php echo Mage::helper('twofactorauth')->__('Remember Me') ?>" id="remember-me" name="remember_me" />&nbsp;<label for="remember-me"><?php echo Mage::helper('twofactorauth')->__('Remember Me') ?></label><br />
                                <?php echo Mage::helper('twofactorauth')->__('Do not require 2-Factor-Authentication on this computer in the future. Do not use this feature on public computers.') ?><br />
                                <?php if ($this->getRequest()->getParam('manual')): ?>
                                <div class="manual-key">
                                    <?php echo $this->__('Account Name: %s', Mage::helper('twofactorauth/auth')->getStoreName()) ?><br />
                                    <?php echo $this->__('Key: ') ?><strong><?php echo $this->getQrCodeSecret() ?></strong><br />
                                    <?php echo $this->__('Type: Time based') ?>
                                </div>
                                <?php else: ?>
                                    <a href="<?php echo $this->getManualKeyUrl() ?>"><?php echo $this->__('Enter key manually') ?></a>
                                <?php endif; ?>
                            </div>
                        </td>
                    </tr>
                </table>
            <?php endif; ?>
            <?php /* Secret questions */ ?>
            <?php echo $this->getChildHtml('questions') ?>
            <div class="form-buttons">
                <a class="left" href="<?php echo $this->getUrl('adminhtml', array('_nosecret' => true)); ?>">&laquo; <?php echo Mage::helper('twofactorauth')->__('Back'); ?></a>
                <button onclick="loginForm.submit()" type="button"><span><span><span><?php echo Mage::helper('twofactorauth')->__('Save'); ?></span></span></span></button>
            </div>
        </fieldset>
    </form>
</div>
</body>
</html>